function initParamEvent(t){$(".input-custom,.input-custom-arrow").click(function(t){t.stopPropagation(),$(this).nextAll(".droplist-custom").show()}),$(".droplist-custom").hover(function(){$(this).parent().children(".input-custom").unbind("blur")},function(){$(this).parent().children(".input-custom").focus().bind("blur",function(){$(this).nextAll(".droplist-custom").hide()})}),$(".droplist-custom>li").click(function(i){i.stopPropagation(),i.preventDefault();var e=$(this),a=$(this).attr("data-value"),n=$(this).attr("data-text"),r=a.split(",");$.each(r,function(t,i){e.parent().parent().children("input").eq(t).val(n).attr("data-value",a).trigger("input")}),e.parent().hide(),e.parent().parent().children("input").blur(),"function"==typeof t&&t(),$(this).closest(".param-group").hasClass("hover")&&$(this).closest(".param-group").addClass("open")}),$("input.input-custom",".param-group").focus(function(){$.rx.paramGetFocus=!0}).blur(function(){$.rx.paramGetFocus&&($.rx.paramGetFocus=!1,"function"==typeof t&&t())}),$(".input-custom.double,.input-custom.int").keypress(function(t){var i=t.which;return $(this).hasClass("double")&&46==i?!0:$(this).hasClass("minus")&&45==i?!0:i>=48&&57>=i||8==i}).blur(function(){var t=parseFloat($(this).val());t=isNaN(t)?$(this).hasClass("empty")?"":0:t;var i=parseFloat($(this).attr("max")),e=parseFloat($(this).attr("min"));t>i?t=i:e>t&&(t=e),$(this).val(t)})}function getFuncPage(t){var i={};switch(t){case"10":i={title:"单频测量",id:"sglfreq",funcno:"10"};break;case"11":i={title:"中频分析",id:"ifanalysis",funcno:"11"};break;case"12":i={title:"单频测向",id:"df",funcno:"12"};break;case"13":i={title:"中频测向",id:"ifdf",funcno:"13"};break;case"14":i={title:"离散扫描",id:"mscan",funcno:"14"};break;case"15":i={title:"频段扫描",id:"fscan",funcno:"15"};break;case"16":i={title:"数字扫描",id:"dscan",funcno:"16"}}return i}function getIframeWindow(t){if(!window)return null;var i,e=window.frames[t]||document.getElementById(t);if(e)try{i=e.contentWindow||e}catch(a){i=e}return i}function ConvertFloat(t,i){var e=parseFloat(t);return e=isNaN(e)?0:e,i&&(e=Math.round(e*Math.pow(10,i))/Math.pow(10,i)),e}function getEventPosition(t){var i,e;return t.layerX||0==t.layerX?(i=t.layerX,e=t.layerY):(t.offsetX||0==t.offsetX)&&(i=t.offsetX,e=t.offsetY),{x:i,y:e}}function getJsonData2(t,i,e,a){return a&&showWait(a),$.ajax({url:fixUrl(t),type:"get",dataType:"json",data:serializeParams(i),complete:function(){a&&hideWait()},error:function(t,i,e){logAjaxErr(t,i,e)},success:function(t){e&&e(t)}})}function getJsonDatasync2(t,i,e,a){return a&&showWait(a),$.ajax({url:fixUrl(t),type:"get",dataType:"json",data:serializeParams(i),async:!1,complete:function(){a&&hideWait()},error:function(t,i,e){logAjaxErr(t,i,e)},success:function(t){e&&e(t)}})}function fixUrl(t){if(/^http:\/\//.test(t)||/^https:\/\//.test(t)||/^\//.test(t))return t;if($.appServerVariables&&/^~/.test(t))return t.replace(/^~\//,$.appServerVariables.appPath);var i=location.pathname.lastIndexOf("/"),e=location.pathname.substring(0,i+1);return e+t}function serializeParams(t){var i={};return t&&$.each(t,function(t,e){var a=$.type(e);"array"===a||"object"===a?i[t]=JSON.stringify(e):i[t]=e}),i}function logAjaxErr(t,i,e){"401"===t.status&&$(document).trigger("accessdenied");var a="web请求失败！\rhttp code:"+t.status+"\r"+t.responseText;xhr=null,"undefined"!=typeof console&&console&&console.log(a)}function isJson(t){return"object"==typeof t&&"[object object]"==Object.prototype.toString.call(t).toLowerCase()&&!t.length}function setLocalStorage(t,i){var e=window.localStorage;e.getItem(t)&&e.removeItem(t),e.setItem(t,i)}function getLocalStorage(t){return window.localStorage.getItem(t)}function downfile(t){var i=$("#ifDownload");0==i.length&&(i=$('<iframe  id="ifDownload" style="display:none;"></iframe>').appendTo($("body"))),window.ActiveXObject||"ActiveXObject"in window?window.open(t):i.attr("src",t)}function popTips(t,i,e){i=i||"info",e=e||2;var a=document.documentElement.clientWidth,n=$("body").find("div.tip-message");0!=n.length&&n.remove();var r="info"==i&&"fa-info-circle"||"success"==i&&"fa-check-circle"||"error"==i&&"fa-times-circle"||"warning"==i&&"fa-warning",o='<div class="tip-message '+i+'"><i class="fa  '+r+'"></i>'+t+"</div>";$("body").append(o),$("div.tip-message").css({top:"150px",left:a/2-13*t.length/2+"px"}).show(),setTimeout(function(){$("div.tip-message").fadeOut(1e3)},1e3*e)}function countTimeLong(t,i){var e=this.timeDiff(t,i),a=Math.floor(e/864e5)+"天",n=e%864e5,r=Math.floor(n/36e5)+"小时",o=n%36e5,s=Math.floor(o/6e4)+"分 ",h=o%6e4,l=Math.round(h/1e3)+"秒",d=a+" "+r+" "+s+" "+l;return d}function timeDiff(t,i){var e=new Date(Date.parse(i.replace(/-/g,"/"))).getTime()-new Date(Date.parse(t.replace(/-/g,"/"))).getTime();return e}function convertToLongDate(t){return 1e4*(new Date(Date.parse(t.replace(/-/g,"/"))).getTime()-new Date("1601/01/01 08:00:00").getTime())}function longDateConvertDateStr(t,i){return i=i||"YYYY-MM-DD HH:mm:ss",new moment((parseInt(t)-116444736e9)/1e4-288e5).format(i)}function getDevStatus(t){var i="未知";switch(t){case"0":i="可用";break;case"1":i="忙碌";break;case"2":i="故障";break;case"3":i="未知";break;case"4":i="可用有任务运行"}return i}function gradientColor(t,i,e){startRGB=this.colorRgb(t),startR=startRGB[0],startG=startRGB[1],startB=startRGB[2],endRGB=this.colorRgb(i),endR=endRGB[0],endG=endRGB[1],endB=endRGB[2],sR=(endR-startR)/e,sG=(endG-startG)/e,sB=(endB-startB)/e;for(var a=[],n=0;e>n;n++){var r=this.colorHex("rgb("+parseInt(sR*n+startR)+","+parseInt(sG*n+startG)+","+parseInt(sB*n+startB)+")");a.push(r)}return a}function gradientColorArr(t,i){var e=[];if("[object Array]"!==Object.prototype.toString.call(t))return e;for(var a=1;a<t.length;a++)e=e.concat(new gradientColor(t[a-1],t[a],parseInt(i/(t.length-1))));for(var a=1;a<i%(t.length-1);a++){var n=parseInt(i/(t.length-1));e.splice(n,0,e[n])}return e}!function(t){"use strict";function i(){var i=t.crypto||t.msCrypto;if(!s&&i&&i.getRandomValues)try{var e=new Uint8Array(16);d=s=function(){return i.getRandomValues(e),e},s()}catch(a){}if(!s){var n=new Array(16);h=s=function(){for(var t,i=0;16>i;i++)0===(3&i)&&(t=4294967296*Math.random()),n[i]=t>>>((3&i)<<3)&255;return n},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function e(){if("function"==typeof require)try{var t=require("crypto").randomBytes;l=s=t&&function(){return t(16)},s()}catch(i){}}function a(t,i,e){var a=i&&e||0,n=0;for(i=i||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){16>n&&(i[a+n++]=f[t])});16>n;)i[a+n++]=0;return i}function n(t,i){var e=i||0,a=p;return a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[e++]]}function r(t,i,e){var a=i&&e||0,r=i||[];t=t||{};var o=null!=t.clockseq?t.clockseq:x,s=null!=t.msecs?t.msecs:(new Date).getTime(),h=null!=t.nsecs?t.nsecs:y+1,l=s-A+(h-y)/1e4;if(0>l&&null==t.clockseq&&(o=o+1&16383),(0>l||s>A)&&null==t.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");A=s,y=h,x=o,s+=122192928e5;var d=(1e4*(268435455&s)+h)%4294967296;r[a++]=d>>>24&255,r[a++]=d>>>16&255,r[a++]=d>>>8&255,r[a++]=255&d;var c=s/4294967296*1e4&268435455;r[a++]=c>>>8&255,r[a++]=255&c,r[a++]=c>>>24&15|16,r[a++]=c>>>16&255,r[a++]=o>>>8|128,r[a++]=255&o;for(var g=t.node||v,p=0;6>p;p++)r[a+p]=g[p];return i?i:n(r)}function o(t,i,e){var a=i&&e||0;"string"==typeof t&&(i="binary"===t?new g(16):null,t=null),t=t||{};var r=t.random||(t.rng||s)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,i)for(var o=0;16>o;o++)i[a+o]=r[o];return i||n(r)}var s,h,l,d,c;t?i():e();for(var g="function"==typeof Buffer?Buffer:Array,p=[],f={},u=0;256>u;u++)p[u]=(u+256).toString(16).substr(1),f[p[u]]=u;var m=s(),v=[1|m[0],m[1],m[2],m[3],m[4],m[5]],x=16383&(m[6]<<8|m[7]),A=0,y=0,w=o;w.v1=r,w.v4=o,w.parse=a,w.unparse=n,w.BufferClass=g,w._rng=s,w._mathRNG=h,w._nodeRNG=l,w._whatwgRNG=d,"undefined"!=typeof module&&module.exports?module.exports=w:"function"==typeof define&&define.amd?define(function(){return w}):(c=t.uuid,w.noConflict=function(){return t.uuid=c,w},t.uuid=w)}("undefined"!=typeof window?window:null),function(t){"use strict";function i(t){"string"==typeof t?(t=JSON.parse(t),this._size=t._size||0,this.datastore=t.datastore||Object.create(null)):(this._size=0,this.datastore=Object.create(null))}i.prototype.toString=function(){return JSON.stringify(this)},i.prototype.isEmpty=function(){return 0===this._size},i.prototype.size=function(){return this._size},i.prototype.clear=function(){for(var t in this.datastore)delete this.datastore[t];this._size=0},i.prototype.add=function(t,i){this.datastore[t]=i,this._size++},i.prototype.find=function(t){return this.datastore[t]},i.prototype.count=function(){var t=0;for(var i in this.datastore)t++;return t},i.prototype.remove=function(t){delete this.datastore[t],this._size--},i.prototype.showAll=function(){for(var t in this.datastore)console.log(t+"->"+this.datastore[t])},t.Dictionary=i}("undefined"!=typeof window?window:null),$.rx={},window.console=window.console||function(){var t={};return t.log=t.warn=t.debug=t.info=t.error=t.time=t.dir=t.profile=t.clear=t.exception=t.trace=t.assert=function(){},t}(),$(function(){$(".nav-custom-tabs>button").click(function(){$(this).closest(".nav-custom").find(".btn-custom").removeClass("active"),$(this).addClass("active");var t=$(this).attr("href");$(this).closest(".nav-custom").next(".tab-custom-content").find(".tab-custom-panel").hide(),$(t).show(),$(this).closest(".nav-custom").next(".tab-custom-content").find(".tab-custom-panel>.tree-container").getNiceScroll().hide(),$(t).children(".tree-container").getNiceScroll().show().resize()}),"undefined"!=typeof $.fn.datetimepicker&&$(".datetime-text").datetimepicker({format:$(this).attr("dateformat")||"yyyy-mm-dd",autoclose:!0,language:"zh-CN",forceParse:!1,startView:2,minView:2})}),String.prototype.format=function(t){var i=this;if(arguments.length>0)if(1==arguments.length&&"object"==typeof t){for(var e in t)if(void 0!=t[e]){var a=new RegExp("({"+e+"})","g");i=i.replace(a,t[e])}}else for(var n=0;n<arguments.length;n++)if(void 0!=arguments[n]){var a=new RegExp("({)"+n+"(})","g");i=i.replace(a,arguments[n])}return i},gradientColor.prototype.colorRgb=function(t){var i=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,t=t.toLowerCase();if(t&&i.test(t)){if(4===t.length){for(var e="#",a=1;4>a;a+=1)e+=t.slice(a,a+1).concat(t.slice(a,a+1));t=e}for(var n=[],a=1;7>a;a+=2)n.push(parseInt("0x"+t.slice(a,a+2)));return n}return t},gradientColor.prototype.colorHex=function(t){var i=t,e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(/^(rgb|RGB)/.test(i)){for(var a=i.replace(/(?:(|)|rgb|RGB)*/g,"").split(","),n="#",r=0;r<a.length;r++){var o=Number(a[r]).toString(16);o=10>o?"0"+o:o,"0"===o&&(o+=o),n+=o}return 7!==n.length&&(n=i),n}if(!e.test(i))return i;var s=i.replace(/#/,"").split("");if(6===s.length)return i;if(3===s.length){for(var h="#",r=0;r<s.length;r+=1)h+=s[r]+s[r];return h}},function($){function Chart(t,i){$this=this,this.target=t,this.container=$(t),this.options=$.extend(!0,{},$.fn.rxchart.defaults,i),this.container.data("option",this.options),this.originOptions=$.extend(!0,{},this.options),this.stepXArr=[],this.stepYArr=[],this.xAxisLabelHeight=this.options.hiddenXAxis?1:30,this.gradientColors=[],this.Colorlegend={left:0,top:0,height:this.options.height-this.xAxisLabelHeight,width:this.options.yAxis.hidden?0:35,ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height}},this.grid={left:this.Colorlegend.left+this.Colorlegend.width,top:this.Colorlegend.top,height:this.Colorlegend.height,width:this.options.width-this.Colorlegend.width,ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height}},this.heightRatio=this.grid.height/(this.options.yAxis.max-this.options.yAxis.min),this.canvasElmBuffer=this._createCanvas(),this.context2DBuffer=this._getContext2D(this.canvasElmBuffer),this.canvasElm=this._createCanvas(this.grid),this.context2D=this._getContext2D(this.canvasElm),this.canvasElmInfo=this._createCanvas(this.grid),this.context2DInfo=this._getContext2D(this.canvasElmInfo),this.canvasElmASThr=this._createCanvas(this.grid),this.context2DASThr=this._getContext2D(this.canvasElmASThr),this.itemWidth=1,this.draw(!0),this.bindMouseEvent()}function _mousemove(t){t.preventDefault();var i=$(this).data("chart");if(t=getEventPosition(t),i.grid.ContainsXY(t.x,t.y)){if(i.dragging)_gridDragging(i,t);else if(i.draggingAThr){var e=i.getValueByY(t.y);i.options.asThrValue=e,i._drawASThreshold(!0)}else{var e=i.getValueByY(t.y);if(i.options.showASThreshold&&Math.abs(i.options.asThrValue-e)<3/i.heightRatio)return i._drawASThreshold(!0),i.container.css({cursor:"pointer"}),void i.context2DInfo.clearRect(i.grid.left,i.grid.top,i.grid.width,i.grid.height);i.container.css({cursor:""}),i.context2DASThr.clearRect(i.grid.left+11,i.grid.top,i.grid.width,i.grid.height),_gridShowInfo(i,t)}"function"==typeof i.options.event.onmousemove&&i.options.event.onmousemove(t)}else _clear(i,t)}function _mousedown(t){if($.rx.paramGetFocus||t.preventDefault(),1==t.which){var i=$(this).data("chart");if(t=getEventPosition(t),i.grid.ContainsXY(t.x,t.y)){var e=i.getValueByY(t.y);i.options.showASThreshold&&Math.abs(i.options.asThrValue-e)<3/i.heightRatio?i.draggingAThr=!0:(i.dragging=!0,i.grid.event=$.extend(i.grid.event||{},{startX:t.x,startY:t.y})),"function"==typeof i.options.event.onmousedown&&i.options.event.onmousedown(t)}}}function _mouseup(t){t.preventDefault();var i=$(this).data("chart");t=getEventPosition(t),i.grid.ContainsXY(t.x,t.y)&&(i.dragging&&_girdDragEnd(i,t),i.draggingAThr&&(i.draggingAThr=!1,"function"==typeof i.options.event.ondrawasthrchanged&&i.options.event.ondrawasthrchanged(i.options.asThrValue)),"function"==typeof i.options.event.onmouseup&&i.options.event.onmouseup(t))}function _dblclick(t){if("CANVAS"!=t.target.tagName)return!1;t.stopPropagation(),t.preventDefault();var i=$(this).data("chart");if(t=getEventPosition(t),i.grid.ContainsXY(t.x,t.y)){var e=i.getValueByY(t.y);if(i.options.showASThreshold&&Math.abs(i.options.asThrValue-e)<3/i.heightRatio){var a=$(document).find("#modalSetAsThr"+i.canvasElm.id);return 0==a.length&&(a=$('<div class="modal modal-custom" role="dialog" aria-labelledby="gridSystemModalLabel"> <div class="modal-dialog modal-sm" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" id="gridSystemModalLabel">设置异常信号门限</h4> </div> <div class="modal-body"> <div class="form-group form-inline"> <label class="control-label">异常信号门限：</label> <div class="input-group"><input type="text" class="form-control input-custom double minus asThrValue" max="120" min="-40" maxlength="6" ><span class="input-custom-addon">dbμv</span> </div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-warning btn-sm" data-dismiss="modal"><i class="">&nbsp;</i>取消</button> <button type="button" class="btn btn-primary btn-sm btnSetAsThrValue" ><i class="fa fa-save">&nbsp;</i>确定</button> </div> </div> </div> </div>'),a.attr("id","modalSetAsThr"+i.canvasElm.id),a.find(".btnSetAsThrValue").click(function(){i.options.asThrValue=ConvertFloat(a.find(".asThrValue").val(),2),i.options.asThrValue>i.options.yAxis.max&&(i.options.asThrValue=i.options.yAxis.max),i.options.asThrValue<i.options.yAxis.min&&(i.options.asThrValue=i.options.yAxis.min),i._drawASThreshold(!0),"function"==typeof i.options.event.ondrawasthrchanged&&i.options.event.ondrawasthrchanged(i.options.asThrValue),a.modal("hide")}),$("body").append(a),"function"==typeof initParamEvent&&initParamEvent()),a.find(".asThrValue").val(ConvertFloat(i.options.asThrValue,2)),void a.modal("show")}if(i.dragging=!1,!i.gridZoomDisable){var n=i.getOption();n.xAxis=i.originOptions.xAxis.map(function(t){return 2==i.options.xAxisType?t:$.extend({},t)});var n=i.getOption();n.dataItemRange=[],i.draw(!0),_gridZoomComplate(i)}"function"==typeof i.options.event.ondblclick&&i.options.event.ondblclick(t)}else if(i.Colorlegend.ContainsXY(t.x,t.y)){var r=$(document).find("#modal"+i.canvasElm.id);0==r.length&&(r=$('<div  class="modal modal-custom" role="dialog" aria-labelledby="gridSystemModalLabel"> <div class="modal-dialog modal-sm" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" id="gridSystemModalLabel">设置坐标上下限</h4> </div> <div class="modal-body"> <div class="form-group form-inline"> <label class="control-label">坐标上限值：</label> <div class="input-group"> <input type="text" class="form-control input-custom int minus yAxisUp" maxlength="3" max="120" ><span class="input-custom-addon">dbμv</span></div> </div> <div class="form-group form-inline"> <label class="control-label">坐标下限值：</label> <div class="input-group"> <input type="text" class="form-control input-custom int minus yAxisDown" maxlength="3" min="-40"  ><span class="input-custom-addon">dbμv</span> </div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-warning btn-sm" data-dismiss="modal"><i class="">&nbsp;</i>取消</button> <button type="button" class="btn btn-primary btn-sm btnSetYAxisUpdown" ><i class="fa fa-save">&nbsp;</i>确定</button> </div> </div></div></div>'),r.attr("id","modal"+i.canvasElm.id),r.find(".btnSetYAxisUpdown").click(function(){return i.options.yAxis.max=ConvertFloat(r.find(".yAxisUp").val(),2),i.options.yAxis.min=ConvertFloat(r.find(".yAxisDown").val(),2),i.options.yAxis.min>i.options.yAxis.max?alert("坐标下限值必须小于上限值"):(i.draw(!0),r.modal("hide"),void("function"==typeof i.options.event.onyaxischanged&&i.options.event.onyaxischanged(i.options)))}),r.find(".yAxisUp").val(i.options.yAxis.max),r.find(".yAxisDown").val(i.options.yAxis.min),$("body").append(r),"function"==typeof initParamEvent&&initParamEvent()),r.modal("show")}}function _click(t){var i=$(this).data("chart");t=getEventPosition(t),i.grid.ContainsXY(t.x,t.y)&&"function"==typeof i.options.event.onclick&&i.options.event.onclick(t)}function _mouseout(t){var i=$(this).data("chart");_clear(i),"function"==typeof i.options.event.onmouseout&&i.options.event.onmouseout(t)}function _clear(t,i){t.dragging=!1,t.grid.event={},t.context2DInfo.clearRect(0,0,t.canvasElmInfo.width,t.canvasElmInfo.height),t.draggingAThr=!1,t.container.css({cursor:""}),t.context2DASThr.clearRect(t.grid.left+11,0,t.canvasElmInfo.width,t.canvasElmInfo.height)}function _girdDragEnd(t,i){if(t.dragging=!1,t.context2DInfo.clearRect(0,0,t.canvasElmInfo.width,t.canvasElmInfo.height),$.extend(t.grid.event,{endX:i.x,endY:i.y}),!(Math.abs(t.grid.event.endX-t.grid.event.startX)<20)){var e=t.getDataItemByX(t.grid.event.startX,!0),a=t.getDataItemByX(t.grid.event.endX,!0);if(e&&a){if(e.index>a.index){var n=$.extend({},e);e=$.extend({},a),a=n}var r=e.index,o=a.index;if(r&&o){var s=t.getOption();if(!(s.data.slice(r,o).length<3)){if(s.dataItemRange=[r,o],t.itemWidth=t.grid.width/s.data.slice(r,o).length,2!=t.options.xAxisType){for(var h=[],l=0;l<s.xAxis.length;l++)s.xAxis[l].endindex>=e.index&&s.xAxis[l].startindex<=a.index&&h.push($.extend({},s.xAxis[l]));h.length>0&&(h[0].startfreq=e.name,h[0].startindex=e.index,h[0].points=parseInt((h[0].endfreq-h[0].startfreq)/h[0].step+1),h[h.length-1].endfreq=a.name,h[h.length-1].endindex=a.index,h[h.length-1].points=parseInt((h[h.length-1].endfreq-h[h.length-1].startfreq)/h[h.length-1].step+1)),s.xAxis=h}t.draw(!0),_gridZoomComplate(t)}}}}}function _gridDragging(chart,event){if($.extend(chart.grid.event,{endX:event.x,endY:event.y}),!(Math.abs(chart.grid.event.endX-chart.grid.event.startX)<5))with(chart.context2DInfo)save(),clearRect(0,0,chart.canvasElmInfo.width,chart.canvasElmInfo.height),beginPath(),translate(.5,.5),lineWidth=1,rect(chart.grid.event.startX,chart.grid.event.startY,chart.grid.event.endX-chart.grid.event.startX,chart.grid.event.endY-chart.grid.event.startY),stroke(),restore()}function _gridShowInfo(chart,event){if("undefined"==typeof chart.showInfo||chart.showInfo){var dataItem=chart.getDataItemByX(event.x);with(chart.context2DInfo){clearRect(chart.grid.left,chart.grid.top,chart.grid.width,chart.grid.height),strokeStyle=chart.options.style.lineColor||"#00fbfe",fillStyle=chart.options.style.textColor||"#2dfbfe",save(),beginPath(),translate(.5,.5),lineWidth=1,moveTo(event.x,chart.grid.top),lineTo(event.x,chart.grid.top+chart.grid.height),moveTo(chart.grid.left,event.y),lineTo(chart.grid.left+chart.grid.width,event.y),textAlign="left";var textX=event.x+5;event.x-chart.grid.left>4*chart.grid.width/5&&(textAlign="right",textX=event.x-5),dataItem&&(fillText(dataItem.name+"MHz",textX,chart.grid.top+10),fillText(ConvertFloat(dataItem.value,3)+(decodeURIComponent(dataItem.unit||"")||"dbμv"),textX,chart.grid.top+25),chart.options.showOccupancy&&fillText((dataItem.occValue||0)+"%",textX,chart.grid.top+40)),stroke(),restore()}}}function _gridZoomComplate(t){"function"==typeof t.options.event.onZoomChanged&&t.options.event.onZoomChanged(t.options)}Chart.prototype={draw:function(t){if(t){if(this.context2DBuffer.clearRect(0,0,this.options.width,this.options.height),this.options.showColorlegend&&this._drawColorlegend(),this._drawYAxis(),"colorlegend"==this.options.type)return;2==this.options.xAxisType?this._drawXAxis2():this._drawXAxis(),"falls"!=this.options.type&&this._drawGrid(),this.options.showOccupancy&&this._drawOccupancy(),this.options.showASThreshold&&this._drawASThreshold()}"falls"==this.options.type?this._drawfalls():this._drawData()},getOption:function(){var t=this.container.data("option");return"undefined"==typeof t&&(t={}),t},setOption:function(t,i,e){var a=this.getOption();this.options=$.extend({},a,t),this.container.data("option",this.options),e&&(this.originOptions=$.extend(!0,{},this.options)),this.draw(i)},setHeight:function(t){this.options.height=t,this.container.height(t+"px"),this.Colorlegend.height=t-this.xAxisLabelHeight,this.grid.height=this.Colorlegend.height,this.heightRatio=this.grid.height/(this.options.yAxis.max-this.options.yAxis.min),this.canvasElmBuffer.height=t,this.canvasElm.height=this.grid.height,this.canvasElmInfo.height=this.grid.height,this.canvasElmASThr.height=this.grid.height,this.setOption({height:t},!0,!0)},resize:function(t,i){this.options.width=t,this.options.height=i,this.container.width(t+"px"),this.container.height(i+"px"),this.Colorlegend.height=i-this.xAxisLabelHeight,this.grid.width=this.options.width-this.Colorlegend.width,this.grid.height=this.Colorlegend.height,this.heightRatio=this.grid.height/(this.options.yAxis.max-this.options.yAxis.min),this.canvasElmBuffer.width=t,this.canvasElmBuffer.height=i,this.canvasElm.width=t,this.canvasElm.height=this.grid.height,this.canvasElmInfo.width=t,this.canvasElmInfo.height=this.grid.height,this.canvasElmASThr.width=t,this.canvasElmASThr.height=this.grid.height,this.setOption({width:t,height:i},!0,!0),this.options.showOccupancy&&this.showOccupancy(),this._redrawfalls()},destroy:function(){this.container.remove("canvas"),this.container.removeData("option"),delete this},clear:function(){_clear(this)},bindMouseEvent:function(t){"falls"==this.options.type?this.container.dblclick(_dblclick):"disabled"!=this.options.mouseEvent&&this.container.mousedown(_mousedown).mousemove(_mousemove).mouseup(_mouseup).dblclick(_dblclick).mouseout(_mouseout).click(_click)},showOccupancy:function(){this.options.showOccupancy=!0,this.OccColorlegend={left:0,top:0,height:59,width:this.options.yAxis.hidden?0:35},this.OccGrid={left:this.OccColorlegend.width,top:1,height:59,width:this.options.width-this.OccColorlegend.width},this.Colorlegend.top=this.OccColorlegend.height+1,this.Colorlegend.height=this.options.height-this.xAxisLabelHeight-this.OccGrid.height-1,this.grid.top=this.Colorlegend.top,this.grid.height=this.Colorlegend.height,this.heightRatio=this.grid.height/(this.options.yAxis.max-this.options.yAxis.min),this.draw(!0),this.canvasElmOcc&&(this.canvasElmOcc.height=this.OccGrid.height)},hideOccupancy:function(){this.options.showOccupancy=!1,this.Colorlegend.top=0,this.Colorlegend.height=this.options.height-this.xAxisLabelHeight,this.grid.top=this.Colorlegend.top,this.grid.height=this.Colorlegend.height,this.heightRatio=this.grid.height/(this.options.yAxis.max-this.options.yAxis.min),this.draw(!0),this.canvasElmOcc.height=0},_drawOccupancy:function(){with(this.context2DOcc||(this.canvasElmOcc=this._createCanvas(this.OccGrid),this.canvasElmOcc.height=this.OccGrid.height+1,this.context2DOcc=this._getContext2D(this.canvasElmOcc)),this.context2DBuffer){save(),font="normal normal 12px 微软雅黑",fillStyle="#2dfbfe",beginPath(),translate(.5,.5);var textValue="占用度";for(i=0;i<textValue.length;i++)fillText(textValue[i],this.OccColorlegend.width/2-2,this.OccColorlegend.height/2+14*(i-1));rect(this.OccGrid.left,this.OccGrid.top-1,this.OccGrid.width-1,this.OccGrid.height+1),stroke(),restore()}},_drawASThreshold:function(drawLine){var asThrValue=this.options.asThrValue=this.options.asThrValue||40,y=this.getYByValue(asThrValue);with(this.context2DASThr)clearRect(this.grid.left,this.grid.top,this.canvasElmASThr.width,this.canvasElmASThr.height),save(),strokeStyle="#f00",fillStyle="#f00",beginPath(),moveTo(this.grid.left+1,y-8),lineTo(this.grid.left+11,y),lineTo(this.grid.left+1,y+8),closePath(),fill(),drawLine&&(beginPath(),translate(.5,.5),moveTo(this.grid.left+11,y),lineTo(this.grid.left+this.grid.width,y),fillStyle="#fff",font="normal normal 14px 微软雅黑",fillText(ConvertFloat(asThrValue,2),this.grid.left+12,y+5),stroke()),restore()},_createCanvas:function(t){this.zIndex=this.zIndex||0;var i=document.createElement("canvas");return $(i).appendTo(this.container).css({position:"absolute",left:"0px",top:(t&&t.top||0)+"px","z-index":++this.zIndex}),i.id=uuid.v1(),i.width=this.options.width,i.height=t&&t.height||this.options.height,i},_getContext2D:function(t){return t=t||this.canvasElm,t.getContext||G_vmlCanvasManager.initElement(t),t.getContext("2d")},_getColor:function(t){if(!this.options.showColorlegend)return this.options.yAxis.colors[0]||"#ff0";for(var i=0,e=this.gradientColors.length-1,a=Math.floor((e+i)/2);a>0&&!(this.gradientColors[a-1].value<=t&&this.gradientColors[a].value>=t)&&e>i;)this.gradientColors[a].value>t?e=a-1:this.gradientColors[a].value<t&&(i=a+1),a=Math.floor((e+i)/2);return this.gradientColors[a].color},getDataItemByX:function(t,i){var e=-1,a=t-this.grid.left;0>a&&(e=-1);var n=this.getSampleData(this.options.data);if(n.length>0){var r=Math.ceil(a/this.itemWidth);(r-1)*this.itemWidth;e=r-1}return n[e]},getSampleData:function(t,i){if("undefined"==typeof t)return[];!i&&this.options.dataItemRange&&2==this.options.dataItemRange.length&&(t=t.slice(this.options.dataItemRange[0],this.options.dataItemRange[1]));var e=[];if(len=this.grid.width||1e3,t.length<=len)return t;for(var a=t.length/len,n=0,r={},o=0,s=0;s<len;s++){n=parseInt(a*s),o=parseInt(a*(s+1)),r=$.extend({},t[n]);for(var h=n+1;o>h;h++)r.value=t[h].value>r.value?t[h].value:r.value,r.maxValue=t[h].maxValue>r.maxValue?t[h].maxValue:r.maxValue,r.minValue=t[h].minValue<r.minValue?t[h].minValue:r.minValue,r.avgValue+=t[h].avgValue;r.index=s,r.avgValue=r.avgValue/(o-n),e.push(r)}return e},getDataByRange:function(t,i,e){var a=[];return t.forEach(function(t){t.name>=i&&t.name<=e&&a.push(t)}),a},getXByIndex:function(t){return this.grid.left+this.itemWidth*t},getYByValue:function(t){return this.grid.top+this.grid.height-t*this.heightRatio+this.options.yAxis.min*this.heightRatio},getValueByY:function(t){return ConvertFloat((this.grid.height+this.grid.top-t)/this.heightRatio+this.options.yAxis.min,3)},getValueByName:function(t){for(var i=this.getSampleData(this.options.data),e=0,a=i.length-1,n=Math.floor((a+e)/2);n>0&&i[n].name!=t&&a>e;)i[n-1].name>t?a=n-1:i[n-1].name<t&&(e=n+1),n=Math.floor((a+e)/2);return i[n+1].value},_drawXAxis:function(){this.stepXArr=[];var textValue,chart=this,xAxisData=chart.options.xAxis,len=xAxisData.length;if(this.options.xAxis.length>0){var fianlData=this.getSampleData(this.options.data);fianlData.length>0&&fianlData.length/this.grid.width<.01&&(fianlData[0].name==this.options.xAxis[0].startfreq&&(this.options.xAxis[0].startfreq-=this.options.xAxis[0].step),fianlData[fianlData.length-1].name==this.options.xAxis[this.options.xAxis.length-1].endfreq&&(this.options.xAxis[this.options.xAxis.length-1].endfreq+=this.options.xAxis[this.options.xAxis.length-1].step))}with(this.context2DBuffer){if(font="normal normal normal 10px 微软雅黑",strokeStyle=this.options.style.lineColor||"rgba(0,177,179,1)",fillStyle=this.options.style.lineColor||"rgba(0,177,179,1)",lineWidth=1,save(),beginPath(),translate(0,0),moveTo(this.grid.left,this.grid.top+this.grid.height),lineTo(this.grid.left+this.grid.width,this.grid.top+this.grid.height),stroke(),moveTo(this.grid.left,this.grid.top),lineTo(this.grid.left+this.grid.width,this.grid.top),translate(.5,.5),1==len){var pointData=chart.getSampleData(chart.options.data||[]);if(0==pointData.length||pointData.length>10){for(var newlen=5,newxAxisData=[],avgValue=(xAxisData[0].endfreq-xAxisData[0].startfreq)/(newlen-1),i=0;newlen>i;i++)newxAxisData.push(ConvertFloat(xAxisData[0].startfreq+avgValue*i,3));for(var xStepWidth=this.grid.width/(newlen-1),i=0;newlen>i;i++)fillStyle=this.options.style.lineColor||"rgba(0,177,179,1)",moveTo(this.grid.left+i*xStepWidth,this.grid.top+this.grid.height),lineTo(this.grid.left+i*xStepWidth,this.grid.top+this.grid.height+6),textValue=newxAxisData[i]+"MHz",textAlign="center",0==i?textAlign="left":i==newlen-1&&(textAlign="right"),fillStyle=this.options.style.textColor||"#2dfbfe",fillText(textValue,this.grid.left+i*xStepWidth,this.grid.top+this.grid.height+18)}else for(var i=0;i<pointData.length;i++)fillStyle=this.options.style.lineColor||"rgba(0,177,179,1)",moveTo(this.grid.left+(i+.5)*chart.itemWidth,this.grid.top+this.grid.height),lineTo(this.grid.left+(i+.5)*chart.itemWidth,this.grid.top+this.grid.height+6),textValue=ConvertFloat(pointData[i].name,3)+"MHz",textAlign="left",fillStyle=this.options.style.textColor||"#2dfbfe",fillText(textValue,+(i+.5)*chart.itemWidth,this.grid.top+this.grid.height+18)}else{var _allpoints=0;chart.options.xAxis.forEach(function(t){_allpoints+=t.points});for(var _startX=this.grid.left,_endX=0,i=0;len>i;i++)_startX=_endX,_endX=_startX+xAxisData[i].points/_allpoints*chart.grid.width,_endX=Math.ceil(_endX/this.itemWidth)*this.itemWidth,fillStyle="#2dfbfe",0==i?(moveTo(this.grid.left+_startX,this.grid.top+this.grid.height),lineTo(this.grid.left+_startX,this.grid.top+this.grid.height+6),textValue=ConvertFloat(xAxisData[i].startfreq,3)+"MHz",fillText(textValue,this.grid.left+_startX,this.grid.top+this.grid.height+18)):(this.stepXArr.push(this.grid.left+_startX),textValue=ConvertFloat(xAxisData[i-1].endfreq,3)+"/"+ConvertFloat(xAxisData[i].startfreq,3)+"MHz",fillText(textValue,this.grid.left+_startX-5*textValue.length/2,this.grid.top+this.grid.height+18)),i==len-1&&(textValue=ConvertFloat(xAxisData[i].endfreq,3)+"MHz",fillText(textValue,this.grid.left+_endX-6*(textValue.length-3)-30,this.grid.top+this.grid.height+18)),moveTo(this.grid.left+_endX,this.grid.top+this.grid.height),lineTo(this.grid.left+_endX,this.grid.top+this.grid.height+6)}stroke(),restore()}},_drawXAxis2:function(){this.stepXArr=[];var textValue,chart=this,xAxisData=chart.options.xAxis;xAxisData.length;with(chart.options.dataItemRange&&2==chart.options.dataItemRange.length&&(xAxisData=chart.originOptions.xAxis.slice(chart.options.dataItemRange[0],chart.options.dataItemRange[1])),this.context2DBuffer){font="normal normal normal 10px 微软雅黑",strokeStyle=this.options.style.lineColor||"rgba(0,177,179,1)",fillStyle=this.options.style.lineColor||"rgba(0,177,179,1)",lineWidth=1,save(),beginPath(),
translate(0,0),moveTo(this.grid.left,this.grid.top+this.grid.height),lineTo(this.grid.left+this.grid.width,this.grid.top+this.grid.height),stroke(),translate(0,.5),moveTo(this.grid.left,this.grid.top),lineTo(this.grid.left+this.grid.width,this.grid.top);for(var newlen=xAxisData.length,xStepWidth=this.grid.width/newlen,isSampling=newlen>=8,i=0;newlen>i;i++)isSampling&&i%parseInt(newlen/8)!=0||(moveTo(this.grid.left+(i+.5)*xStepWidth,this.grid.top+this.grid.height),lineTo(this.grid.left+(i+.5)*xStepWidth,this.grid.top+this.grid.height+6),textValue=xAxisData[i]+"MHz",textAlign="center",fillStyle="#2dfbfe",fillText(textValue,this.grid.left+(i+.5)*xStepWidth,this.grid.top+this.grid.height+18),this.stepXArr.push(this.grid.left+(i+.5)*xStepWidth));stroke(),restore()}},_drawYAxis:function(){this.stepYArr=[];var yMax=this.options.yAxis.max,step=this.options.yAxis.step,yMin=this.options.yAxis.min;with(this.heightRatio=this.grid.height/(yMax-yMin),this.context2DBuffer){font="normal normal normal 10px 微软雅黑",strokeStyle=this.options.style.lineColor||"rgba(0,177,179,1)",fillStyle=this.options.style.lineColor||"rgba(0,177,179,1)",lineWidth=1,"colorlegend"!=this.options.type&&(save(),beginPath(),translate(.5,0),moveTo(this.grid.left,this.grid.top),lineTo(this.grid.left,this.grid.top+this.grid.height),translate(-1,0),moveTo(this.grid.left+this.grid.width,this.grid.top),lineTo(this.grid.left+this.grid.width,this.grid.top+this.grid.height));for(var tickWidth=this.grid.height/step,i=0;step>=i;i++){if(moveTo(this.grid.left,this.grid.top+this.grid.height-tickWidth*i),lineTo(this.grid.left,this.grid.top+this.grid.height-tickWidth*i),font="normal normal 10px 微软雅黑",fillStyle="#000",i%2==0){var textoffset=4;0==i?textoffset=-2:i==step&&(textoffset=9),textAlign="right",textXoffset=-3,"colorlegend"==this.options.type&&(textAlign="left",textXoffset=-30);var textValue=Math.round((yMax-yMin)/step*i+yMin);fillText(textValue,this.grid.left+textXoffset,this.grid.top+this.grid.height-tickWidth*i+textoffset)}this.stepYArr.push(this.grid.top+this.grid.height-tickWidth*i)}stroke(),restore()}},_drawGrid:function(){with(this.context2DBuffer){save(),strokeStyle="rgba(0,77,77)",globalAlpha="0.8",fillStyle="#fff",lineWidth=.5,translate(.25,.25);for(var j=0,stepX=parseInt(this.grid.width/10),stepY=this.grid.height/10,i=1,len=this.stepYArr.length-1;len>i;i++){for(beginPath(),j=1;stepX>j;j++)moveTo(this.grid.left+10*j,this.stepYArr[i]),lineTo(this.grid.left+10*j+4,this.stepYArr[i]);stroke()}if(this.options.xStep)for(var xStep=this.options.xStep||5,xStepWidth=this.grid.width/(xStep-1),i=0;xStep>i;i++)this.stepXArr.push(this.grid.left+(i+1)*xStepWidth);for(var i=0,len=this.stepXArr.length;len>i;i++){for(beginPath(),j=1;stepY>j;j++)moveTo(this.stepXArr[i],this.grid.top+10*j),lineTo(this.stepXArr[i],this.grid.top+10*j+4);stroke()}restore()}},_drawColorlegend:function(){if(!(this.options.yAxis.colors.length<2)){var gradient=new gradientColorArr(this.options.yAxis.colors,this.grid.height),valStep=Math.round(parseFloat(this.options.yAxis.max-this.options.yAxis.min)/this.grid.height*100)/100,len=gradient.length;with(this.context2DBuffer){save(),beginPath(),fillStyle=gradient[0],strokeStyle=gradient[0],fillRect(this.Colorlegend.left,this.Colorlegend.top-1,this.Colorlegend.width,1);for(var i=0;len>i;i++)this.gradientColors.push({value:this.options.yAxis.min+valStep*i,color:gradient[len-1-i]}),fillStyle=gradient[i],strokeStyle=gradient[i],fillRect(this.Colorlegend.left-2,this.Colorlegend.top+i,this.Colorlegend.width,1),fill();font="normal normal 12px 幼园",fillStyle="#000";var title=this.options.title||"dbμv";translate(this.Colorlegend.left+8,(this.Colorlegend.top+this.Colorlegend.height+(this.options.showOccupancy?60:0))/2+4*title.length),rotate(270*Math.PI/180),fillText(title,5,5),restore()}}},_drawData:function(){var chart=this,data=chart.options.data||[],barData=chart.getSampleData(data);chart.itemWidth=1;var barHeight=0,len=barData.length;if(0!=len)with(len>=chart.grid.width?len=chart.grid.width:chart.itemWidth=chart.grid.width/len,chart.context2D){save(),clearRect(0,0,this.canvasElm.width,this.canvasElm.height),chart.options.showOccupancy&&(chart.context2DOcc.fillStyle="#000",chart.context2DOcc.fillRect(this.OccGrid.left+1,1,this.OccGrid.width-2,this.OccGrid.height));for(var i=0;len>i;i++)if("undefined"!=typeof barData[i]&&"undefined"!=typeof barData[i].value){beginPath(),barHeight=barData[i].value*chart.heightRatio-chart.options.yAxis.min*chart.heightRatio;var y=chart.getYByValue(barData[i].value);if(y<chart.grid.top&&(y=chart.grid.top,barHeight=chart.grid.height),"bar"==chart.options.type)fillStyle=chart._getColor(barData[i].value),2==chart.options.xAxisType?fillRect(chart.grid.left+i*chart.itemWidth+chart.itemWidth/2,y,1,barHeight):fillRect(chart.grid.left+i*chart.itemWidth+(chart.itemWidth-1)/6,y,(chart.itemWidth-1)/6*4+1,barHeight);else if("line"==chart.options.type){if(beginPath(),strokeStyle=chart._getColor(barData[i].value),i+1>=len)return;moveTo(chart.grid.left+i*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i].value)),lineTo(chart.grid.left+(i+1)*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i+1].value)),stroke()}chart.options.showMax&&(beginPath(),strokeStyle="#f00",i-1>=0&&(moveTo(chart.grid.left+(i-1)*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i-1].maxValue)),lineTo(chart.grid.left+i*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i].maxValue)),stroke())),chart.options.showMin&&(beginPath(),strokeStyle="#0065fc",i-1>=0&&(moveTo(chart.grid.left+(i-1)*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i-1].minValue)),lineTo(chart.grid.left+i*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i].minValue)),stroke())),chart.options.showAvg&&(beginPath(),strokeStyle="#ffa500",i-1>=0&&(moveTo(chart.grid.left+(i-1)*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i-1].avgValue)),lineTo(chart.grid.left+i*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i].avgValue)),stroke())),chart.options.showOccupancy&&(chart.context2DOcc.fillStyle="#52caf3",y=this.OccGrid.top+this.OccGrid.height-barData[i].occValue*(chart.OccGrid.height/100),chart.context2DOcc.fillRect(chart.OccGrid.left+i*chart.itemWidth+(chart.itemWidth-1)/6,y,(chart.itemWidth-1)/6*4+1,barData[i].occValue*(chart.OccGrid.height/100))),chart.options.showThreshold&&(beginPath(),strokeStyle="#f00",i-1>=0&&(moveTo(chart.grid.left+(i-1)*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i-1].thrValue)),lineTo(chart.grid.left+i*chart.itemWidth+chart.itemWidth/2,chart.getYByValue(barData[i].thrValue)),stroke())),"function"==typeof chart.options.event.ondatadrawing&&chart.options.event.ondatadrawing(i,barData[i])}restore()}},_redrawfalls:function(){var t=this;t.options.cacheFallsData=t.options.cacheFallsData||[],t.fallsY=0,t.options.cacheFallsData.forEach(function(i){t._drawfalls(i,!0)})},_drawfalls:function(data,noCache){var fallsHeight=5,chart=this;data=data||chart.options.data||[],noCache||(chart.options.cacheFallsData=chart.options.cacheFallsData||[],chart.options.cacheFallsData.length>Math.ceil(this.options.height/fallsHeight)&&chart.options.cacheFallsData.splice(0,1),chart.options.cacheFallsData.push(data));var fallsData=chart.getSampleData(data);chart.itemWidth=1;var len=fallsData.length;if(0!=len)with(len>=chart.grid.width?len=chart.grid.width:chart.itemWidth=chart.grid.width/len,chart.context2D){if(chart.fallsY>=chart.grid.height){chart.fallsY=chart.grid.height;var imgData=getImageData(chart.grid.left,fallsHeight,chart.grid.width,chart.grid.height-fallsHeight);clearRect(0,0,chart.canvasElm.width,chart.canvasElm.height),putImageData(imgData,chart.grid.left,1)}else chart.fallsY=(chart.fallsY||0)+fallsHeight;for(var i=0;len>i;i++)"undefined"!=typeof fallsData[i]&&"undefined"!=typeof fallsData[i].value&&(beginPath(),fillStyle=chart._getColor(fallsData[i].value),fillRect(chart.grid.left+i*chart.itemWidth-.5,chart.fallsY-fallsHeight,chart.itemWidth+1,fallsHeight))}},_drawMark:function(index,dataItem){with(chart.context2DMark||(this.canvasElmMark=this._createCanvas(this.grid),this.context2DMark=this._getContext2D(this.canvasElmMark)),chart.context2DMark)save(),clearRect(0,0,this.canvasElmMark.width,this.canvasElmMark.height),beginPath(),fillStyle="#2dfbfe",moveTo(chart.grid.left+index*this.itemWidth+chart.itemWidth/2-6,this.getYByValue(dataItem.value)-12),lineTo(chart.grid.left+index*this.itemWidth+chart.itemWidth/2+6,this.getYByValue(dataItem.value)-12),lineTo(chart.grid.left+index*this.itemWidth+chart.itemWidth/2,this.getYByValue(dataItem.value)),fill(),restore()}},$.fn.rxchart=function(t){var i=new Chart(this,t);return $(this).data("chart",i),i},$.fn.rxchart.defaults={width:850,height:450,type:"bar",showColorlegend:!0,mouseEvent:"enabled",hiddenXAxis:!1,style:{textColor:"#2dfbfe",lineColor:"rgba(0,177,179,1)"},xAxis:{min:100,max:200,step:5,unit:"MHz"},yAxis:{min:-20,max:80,step:10,hidden:!1,align:"right",colors:["#7aff00","#00fa00","#055605"]},data:[],event:{onzoomchanged:function(){},onyaxischanged:function(){},ondrawasthrchanged:function(){},onclick:function(){},onmousemove:function(){},onmousedown:function(){},onmouseup:function(){},onmouseout:function(){},ondblclick:function(){}}}}(jQuery),function($){function Chart(t,i){$this=this,this.target=t,this.container=$(t),this.options=$.extend(!0,{},$.fn.rxdfchart.defaults,i),this.container.data("option",this.options),this.originOptions=$.extend(!0,{},this.options),this.stepXArr=[],this.stepYArr=[],this.xAxisLabelHeight="falls"==this.options.type?1:30,this.gradientColors=[],this.AzimuthCircle={left:0,top:0,height:this.options.height,width:this.options.height-30,isNorthAngle:!0,ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height}},this.AzimuthCircle.northImage=new Image,this.AzimuthCircle.northImage.src="../images/measure/df/north.png",this.AzimuthCircle.northPointImage=new Image,this.AzimuthCircle.northPointImage.src="../images/measure/df/north-point.png",this.AzimuthCircle.carheadImage=new Image,this.AzimuthCircle.carheadImage.src="../images/measure/df/carhead.png",this.AzimuthCircle.centerX=this.AzimuthCircle.left+this.AzimuthCircle.width/2+5,this.AzimuthCircle.centerY=this.AzimuthCircle.top+this.AzimuthCircle.height/2+10,this.AzimuthCircle.radius=(this.AzimuthCircle.width<this.AzimuthCircle.height?this.AzimuthCircle.width:this.AzimuthCircle.height)/2-10,this.AzimuthCircle.isCenterPoint=function(t,i){return t>=this.centerX-10&&t<=this.centerX+10&&i>=this.centerY-10&&i<=this.centerY+10},this.LevelMeter={left:this.AzimuthCircle.left+this.AzimuthCircle.width+50,top:10,height:this.options.height/3*2-20,width:60,min:-30,max:90,heightRatio:(this.options.height/3*2-20)/120,name:"电平",filterImage:function(){var t=new Image;return t.src="../images/measure/df/fill_level_quality.png",t}(),ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height},isCenterPosition:function(t,i){return t>=this.left+28&&t<=this.left+47&&i>=this.top&&i<=this.top+this.height}},this.QualityMeter={left:this.LevelMeter.left+this.LevelMeter.width+20,top:10,height:this.LevelMeter.height,width:60,min:0,max:100,heightRatio:this.LevelMeter.height/100,name:"质量",filterImage:function(){var t=new Image;return t.src="../images/measure/df/fill_level_quality.png",t}(),ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height},isCenterPosition:function(t,i){return t>=this.left+28&&t<=this.left+47&&i>=this.top&&i<=this.top+this.height}},this.OptimalAngleGrid={left:this.QualityMeter.left+this.QualityMeter.width+20,top:10,height:this.options.height/2-10,width:this.options.width-(this.QualityMeter.left+this.QualityMeter.width+20),heightRatio:(this.options.height/2-20)/30,data:new Array(360),maxTimes:30,ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height}},this.RealtimeAngleGrid={left:this.OptimalAngleGrid.left,top:this.OptimalAngleGrid.top+this.OptimalAngleGrid.height+20,height:this.options.height-this.OptimalAngleGrid.height-32,width:this.OptimalAngleGrid.width,heightRatio:(this.options.height-this.OptimalAngleGrid.height-32)/360,data:[],itemWidth:5,ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height}},this.canvasElmBuffer=this._createCanvas(),this.context2DBuffer=this._getContext2D(this.canvasElmBuffer),this.canvasElm=this._createCanvas(this.grid),this.context2D=this._getContext2D(this.canvasElm),this.canvasElmInfo=this._createCanvas(this.grid),this.context2DInfo=this._getContext2D(this.canvasElmInfo),this.itemWidth=1,this.draw(!0),this.bindMouseEvent()}function ChangeCenterImage(chart){var centerX=chart.AzimuthCircle.centerX,centerY=chart.AzimuthCircle.centerY,radius=chart.AzimuthCircle.radius;with(chart.context2DBuffer)save(),fillStyle="#2d3132",beginPath(),fillRect(centerX-10,centerY-10,20,20),clearRect(centerX-8,centerY-radius-30,21,21),chart.AzimuthCircle.isNorthAngle?(drawImage(chart.AzimuthCircle.carheadImage,centerX-8,centerY-8,16,16),drawImage(chart.AzimuthCircle.northPointImage,centerX-8,centerY-radius-30,16,21)):(drawImage(chart.AzimuthCircle.northImage,centerX-8,centerY-8,16,16),drawImage(chart.AzimuthCircle.carheadImage,centerX-8,centerY-radius-30,16,21)),stroke(),restore()}function _mousedown(t){$.rx.paramGetFocus||t.preventDefault();var i=$(this).data("chart");if(t=getEventPosition(t),i.LevelMeter.isCenterPosition(t.x,t.y)){var e=i._getMeterValueByY(i.LevelMeter,t.y);Math.abs(e-(i.LevelMeter.filterValue||0))<=4&&(i.levelMeterDragging=!0)}else if(i.QualityMeter.isCenterPosition(t.x,t.y)){var e=i._getMeterValueByY(i.QualityMeter,t.y);Math.abs(e-(i.QualityMeter.filterValue||0))<=4&&(i.qualityMeterDragging=!0)}}function _mouseup(t){t.stopPropagation(),t.preventDefault();var i=$(this).data("chart");i.levelMeterDragging?i.levelMeterDragging=!1:i.qualityMeterDragging&&(i.qualityMeterDragging=!1)}function _click(t){t.preventDefault();var i=$(this).data("chart");t=getEventPosition(t),i.AzimuthCircle.isCenterPoint(t.x,t.y)&&(i.AzimuthCircle.isNorthAngle?i.AzimuthCircle.isNorthAngle=!1:i.AzimuthCircle.isNorthAngle=!0,ChangeCenterImage(i))}function _mousemove(t){t.preventDefault();var i=$(this).data("chart");if(t=getEventPosition(t),i.AzimuthCircle.isCenterPoint(t.x,t.y)?i.container.css({cursor:"pointer"}):i.container.css({cursor:"default"}),i.OptimalAngleGrid.ContainsXY(t.x,t.y)||i.RealtimeAngleGrid.ContainsXY(t.x,t.y)?_gridShowInfo(i,t):i.context2DInfo.clearRect(i.OptimalAngleGrid.left,0,i.canvasElmInfo.width,i.canvasElmInfo.height),i.LevelMeter.isCenterPosition(t.x,t.y)){var e=i._getMeterValueByY(i.LevelMeter,t.y);Math.abs(e-(i.LevelMeter.filterValue||0))<=4?i.container.css({cursor:"pointer"}):i.container.css({cursor:"default"})}else i.levelMeterDragging=!1;if(i.QualityMeter.isCenterPosition(t.x,t.y)){var e=i._getMeterValueByY(i.QualityMeter,t.y);Math.abs(e-(i.QualityMeter.filterValue||0))<=4?i.container.css({cursor:"pointer"}):i.container.css({cursor:"default"})}else i.qualityMeterDragging=!1;i.levelMeterDragging&&(i.LevelMeter.filterValue=i._getMeterValueByY(i.LevelMeter,t.y),i._drawMeterfilterValue(i.LevelMeter)),i.qualityMeterDragging&&(i.QualityMeter.filterValue=i._getMeterValueByY(i.QualityMeter,t.y),i._drawMeterfilterValue(i.QualityMeter))}function _gridShowInfo(chart,event){var options,tempHeight,textArr=[],x=event.x-chart.OptimalAngleGrid.left-20;if(chart.OptimalAngleGrid.ContainsXY(event.x,event.y)){if(!chart.OptimalAngleGrid.itemWidth)return;options=chart.OptimalAngleGrid,tempHeight=options.height-10;var index=parseInt(x/chart.OptimalAngleGrid.itemWidth);textArr.push("监测角度："+index+" °"),textArr.push("出现次数："+(chart.OptimalAngleGrid.data[index]||0))}else if(chart.RealtimeAngleGrid.ContainsXY(event.x,event.y)){if(!chart.RealtimeAngleGrid.itemWidth)return;options=chart.RealtimeAngleGrid,tempHeight=options.height;var index=parseInt(x/chart.RealtimeAngleGrid.itemWidth);textArr.push("监测角度："+(chart.RealtimeAngleGrid.data[index]||0)+" °")}with(chart.context2DInfo){clearRect(options.left,options.top,options.width,options.height+1),strokeStyle="#00fbfe",fillStyle="#2dfbfe",save(),beginPath(),translate(.5,.5),lineWidth=1,moveTo(event.x,options.top),lineTo(event.x,options.top+tempHeight),moveTo(options.left+20,event.y),lineTo(options.left+20+options.width,event.y);var textX=event.x+5;if(event.x-options.left>4*options.width/5&&(textX=event.x-55),textArr.length>0)for(var i=0;i<textArr.length;i++)fillText(textArr[i],textX,options.top+10+15*i);stroke(),restore()}}Chart.prototype={draw:function(t){if(t){if(this.context2DBuffer.clearRect(0,0,this.options.width,this.options.height),this.drawAzimuthCircle(),this.drawTextMark(),this.options.showMin)return;this.drawMeter(this.LevelMeter),this.drawMeter(this.QualityMeter),this.drawOptimalAngleGrid(),this.drawRealtimeAngleGrid()}this.drawData()},getOption:function(){var t=this.container.data("option");return"undefined"==typeof t&&(t={}),t},setOption:function(t,i,e){var a=this.getOption();this.options=$.extend({},a,t),this.container.data("option",this.options),e&&(this.originOptions=$.extend(!0,{},this.options)),this.draw(i)},resize:function(t,i){this.options.width=t,this.options.height=i,this.container.width(t+"px"),this.container.height(i+"px"),this.AzimuthCircle.height=i,this.AzimuthCircle.width=i-30,this.AzimuthCircle.centerX=this.AzimuthCircle.left+this.AzimuthCircle.width/2+5,this.AzimuthCircle.centerY=this.AzimuthCircle.top+this.AzimuthCircle.height/2+10,this.AzimuthCircle.radius=(this.AzimuthCircle.width<this.AzimuthCircle.height?this.AzimuthCircle.width:this.AzimuthCircle.height)/2-10,this.LevelMeter.left=this.AzimuthCircle.left+this.AzimuthCircle.width+50,this.LevelMeter.height=this.options.height/3*2-20,this.LevelMeter.heightRatio=(this.options.height/3*2-20)/120,this.QualityMeter.left=this.LevelMeter.left+this.LevelMeter.width+20,this.QualityMeter.height=this.LevelMeter.height,this.QualityMeter.heightRatio=this.LevelMeter.height/100,this.OptimalAngleGrid.left=this.QualityMeter.left+this.QualityMeter.width+20,this.OptimalAngleGrid.height=this.options.height/2-10,this.OptimalAngleGrid.width=this.options.width-(this.QualityMeter.left+this.QualityMeter.width+20),this.OptimalAngleGrid.heightRatio=(this.options.height/2-20)/30,this.RealtimeAngleGrid.left=this.OptimalAngleGrid.left,this.RealtimeAngleGrid.top=this.OptimalAngleGrid.top+this.OptimalAngleGrid.height+20,this.RealtimeAngleGrid.height=this.options.height-this.OptimalAngleGrid.height-32,this.RealtimeAngleGrid.width=this.OptimalAngleGrid.width,this.RealtimeAngleGrid.heightRatio=(this.options.height-this.OptimalAngleGrid.height-32)/360,this.canvasElmBuffer.width=t,this.canvasElmBuffer.height=i,this.canvasElm.width=t,this.canvasElm.height=i,this.canvasElmInfo.width=t,this.canvasElmInfo.height=i,$(".optimal-mark").css({left:this.OptimalAngleGrid.left+30+"px",top:this.OptimalAngleGrid.top+5+"px"}),$(".text-mark").css({left:this.LevelMeter.left+"px",top:this.LevelMeter.top+this.LevelMeter.height+15+"px"}),$(".freq-mark").css({left:this.AzimuthCircle.left+this.AzimuthCircle.width/2-100+"px",top:this.AzimuthCircle.top+this.AzimuthCircle.height-25+"px"}),this.setOption({width:t,height:i},!0,!0)},destroy:function(){this.container.remove("canvas"),this.container.removeData("option"),delete this},clear:function(){_clear(this)},bindMouseEvent:function(t){"disabled"!=this.options.mouseEvent&&this.container.mousedown(_mousedown).mousemove(_mousemove).mouseup(_mouseup).click(_click)},_createCanvas:function(t){this.zIndex=this.zIndex||0;var i=document.createElement("canvas");return $(i).appendTo(this.container).css({position:"absolute",left:"0px",top:(t&&t.top||0)+"px","z-index":++this.zIndex}),i.id=uuid.v1(),i.width=this.options.width,i.height=t&&t.height||this.options.height,i},_getContext2D:function(t){return t=t||this.canvasElm,t.getContext||G_vmlCanvasManager.initElement(t),t.getContext("2d")},getDataItemByX:function(t,i){var e=-1,a=t-this.grid.left;0>a&&(e=-1);var n=this.getSampleData(this.options.data);if(n.length>0){var r=Math.ceil(a/this.itemWidth);(r-1)*this.itemWidth;e=r-1}return n[e]},getSampleData:function(t){if(this.options.dataItemRange&&2==this.options.dataItemRange.length&&(t=t.slice(this.options.dataItemRange[0],this.options.dataItemRange[1])),len=this.grid.width||1e3,t.length<=len)return t;for(var i=[],e=t.length/len,a=0,n={},r=0,o=0;o<len;o++){a=parseInt(e*o),r=parseInt(e*(o+1)),n=t[a];for(var s=a+1;r>s;s++)n.value=t[s].value>n.value?t[s].value:n.value,n.maxValue=t[s].maxValue>n.maxValue?t[s].maxValue:n.maxValue,n.minValue=t[s].minValue<n.minValue?t[s].minValue:n.minValue,n.avgValue+=t[s].avgValue;n.index=o,n.avgValue=n.avgValue/(r-a),i.push(n)}return i},getDataByRange:function(t,i,e){var a=[];return t.forEach(function(t){t.name>=i&&t.name<=e&&a.push(t)}),a},getXByIndex:function(t){},getYByValue:function(t){return this.grid.top+this.grid.height-t*this.heightRatio+this.options.yAxis.min*this.heightRatio},getValueByY:function(t){return ConvertFloat((this.grid.height+this.grid.top-t)/this.heightRatio+this.options.yAxis.min,3)},drawAzimuthCircle:function(){var chart=this,centerX=chart.AzimuthCircle.centerX,centerY=chart.AzimuthCircle.centerY,radius=chart.AzimuthCircle.radius,minangle=1/30*Math.PI;with(chart.context2DBuffer){save(),beginPath(),lineWidth=16,strokeStyle="#469090",arc(centerX,centerY,radius,.67*Math.PI,2.34*Math.PI,!1),stroke(),beginPath(),fillStyle="#2d3132",arc(centerX,centerY,radius-65,0,2*Math.PI,!1),fill(),beginPath(),lineWidth=1,strokeStyle="#2dfbfe",translate(centerX,centerY);for(var i=0;60>i;i++)0!=i&&15!=i&&30!=i&&45!=i||(moveTo(radius-55,0),lineTo(radius-35,0)),moveTo(radius-45,0),lineTo(radius-35,0),rotate(minangle);font=" bold 15px impack",fillStyle="#2dfbfe",fillText("0",-4,-(radius-30)),fillText("90",radius-30,4),fillText("180",-10,radius-20),fillText("270",-(radius-10),4.5),stroke(),restore(),beginPath(),font=" normal 12px impack",fillStyle="#fff",fillText("正北角：",0,15),fillText("车头角：",0,40),drawImage(chart.AzimuthCircle.northPointImage,50,3,15,15),drawImage(chart.AzimuthCircle.carheadImage,50,28,15,15),ChangeCenterImage(chart),chart.AzimuthCircle.northPointImage.onload=function(){drawImage(chart.AzimuthCircle.northPointImage,50,3,15,15),drawImage(chart.AzimuthCircle.carheadImage,50,28,15,15),ChangeCenterImage(chart)},stroke(),restore()}this.drawAzimuthCircleData()},drawMeter:function(options){var chart=this,meterBackImage=new Image;with(meterBackImage.src="../images/measure/df/fill_back.png",chart.context2DBuffer){save(),strokeStyle="#00fbfe",fillStyle="#2d3132",beginPath(),lineWidth=1,rect(options.left+30+.5,options.top,13,options.height),fill(),stroke(),beginPath(),drawImage(meterBackImage,options.left+32,options.top+1,10,options.height-2),meterBackImage.onload=function(){drawImage(meterBackImage,options.left+32,options.top+1,10,options.height-2)},stroke(),restore(),save(),beginPath(),font=" normal 11px impack",strokeStyle="#469090",fillStyle="#2dfbfe",lineWidth=1;for(var step=(options.max-options.min)/10,i=0;11>i;i++){var y=options.top+step*i*options.heightRatio;moveTo(options.left+20,y),lineTo(options.left+29,y);var textValue=(options.max-step*i).toString();fillText(textValue,options.left-3*textValue.length+10,y+3)}stroke(),fillStyle="#fff",font=" normal 12px impack";for(var i=0;i<options.name.length;i++)fillText(options.name[i],options.left+46,(options.top+options.height)/2-10+20*i);stroke(),restore()}this._drawMeterfilterValue(options)},_drawMeterfilterValue:function(options){var chart=this,filterImage=options.filterImage;with(chart.context2DInfo){clearRect(options.left,options.top-10,options.width,options.height+20),save(),beginPath(),drawImage(filterImage,options.left+28,options.height-((options.filterValue||0)-options.min)*options.heightRatio+2,19,14),filterImage.onload=function(){drawImage(filterImage,options.left+28,options.height-((options.filterValue||0)-options.min)*options.heightRatio+2,19,14)},font=" normal 10px impack",fillStyle="#fff",textAlign="center";var offsetY=0;options.max-options.filterValue<5&&(offsetY=25),fillText(options.filterValue||0,options.left+37,options.height-((options.filterValue||0)-options.min)*options.heightRatio+2+offsetY),stroke(),restore()}},_getMeterValueByY:function(t,i){return Math.round((t.height+t.top-i)/t.heightRatio+t.min)},drawTextMark:function(){var t=this,i=$(".freq-mark",t.container);if(0==i.length&&(i=$('<div class="freq-mark" style="color: #f060a0; width: 200px; height: 25px; text-align: center; font-size: 15px; font-weight: bold;">0MHz</div>').css({position:"absolute",left:t.AzimuthCircle.left+t.AzimuthCircle.width/2-100+"px",top:t.AzimuthCircle.top+t.AzimuthCircle.height-25+"px","z-index":100}).appendTo(t.container)),!this.options.showMin){var e=$(".text-mark",t.container);0==e.length&&(e=$('<div class="text-mark" style="color: #fff;  width: 160px; text-align: left; font-size: 12px; "></div>').css({position:"absolute",left:t.LevelMeter.left+"px",top:t.LevelMeter.top+t.LevelMeter.height+15+"px","z-index":100}).appendTo(t.container),e.append('<div><span style="width: 80px;display:inline-block;">[中心频率]：</span><span class="freq">0</span>&nbsp;MHz</div>'),e.append('<div><span style="width: 80px;display:inline-block;">[测向电平]：</span><span class="dfLevel">0</span>&nbsp;dbμv</div>'),e.append('<div><span style="width: 80px;display:inline-block;">[监测电平]：</span><span class="level">0</span>&nbsp;dbμv</div>'),e.append('<div><span style="width: 80px;display:inline-block;">[正北方向]：</span><span class="north">0</span>&nbsp;°</div>'),e.append('<div><span style="width: 80px;display:inline-block;">[最优角度]：</span><span class="optimal">0</span>&nbsp;°</div>'),e.append('<div><span style="width: 80px;display:inline-block;">[测量质量]：</span><span class="qulity">0</span>&nbsp;%</div>'));var a=$(".optimal-mark",t.container);0==a.length&&(a=$('<div class="optimal-mark" style="color: #fff;  width: 160px; text-align: left; font-size: 12px; "></div>').css({position:"absolute",left:t.OptimalAngleGrid.left+30+"px",top:t.OptimalAngleGrid.top+5+"px","z-index":100}).appendTo(t.container),a.append('<div style="color:#cc00cc;"><span style="display:inline-block;">最优角：</span><span class="optimal"></span></div>'),a.append('<div style="color:#0a8a1f;"><span style="display:inline-block;">次优角：</span><span class="suboptimal"></span></div>'),a.append('<div style="color:#985f0d;"><span style="display:inline-block;">再优角：</span><span class="superior"></span></div>'))}},drawOptimalAngleGrid:function(){var chart=this;with(chart.context2DBuffer){save(),lineWidth=1,fillStyle="rgba(0,177,179,1)",strokeStyle="rgba(0,177,179,1)",beginPath(),rect(chart.OptimalAngleGrid.left+20,chart.OptimalAngleGrid.top+.5,chart.OptimalAngleGrid.width-.5-20,chart.OptimalAngleGrid.height-10),stroke(),save(),beginPath(),strokeStyle="rgba(0,77,77)",globalAlpha="0.8",lineWidth=.5,translate(.25,.25);for(var j=0,stepX=parseInt((this.OptimalAngleGrid.width-20)/10),stepY=this.OptimalAngleGrid.height/10,yStepHeight=(this.OptimalAngleGrid.height-10)/6,i=1,len=6;len>i;i++){for(beginPath(),j=0;stepX>=j;j++)moveTo(this.OptimalAngleGrid.left+20+10*j,this.OptimalAngleGrid.top+i*yStepHeight),lineTo(this.OptimalAngleGrid.left+20+10*j+4,this.OptimalAngleGrid.top+i*yStepHeight);stroke()}font=" normal 10px impack",fillStyle="#fff";for(var xStepWidth=(this.OptimalAngleGrid.width-20)/12,i=0,len=12;len>i;i++){for(beginPath(),j=1;stepY-1>=j;j++)moveTo(this.OptimalAngleGrid.left+20+(i+1)*xStepWidth,this.OptimalAngleGrid.top+10*j-10),lineTo(this.OptimalAngleGrid.left+20+(i+1)*xStepWidth,this.OptimalAngleGrid.top+10*j+4-10);fillText(30*i,this.OptimalAngleGrid.left+20+i*xStepWidth-(0==i?0:2*(30*i).toString().length),this.OptimalAngleGrid.top+this.OptimalAngleGrid.height),stroke()}fillText(359,this.OptimalAngleGrid.left+this.OptimalAngleGrid.width-18,this.OptimalAngleGrid.top+this.OptimalAngleGrid.height),stroke(),restore()}this.drawOptimalAngleGridYAxisLabel()},drawOptimalAngleGridYAxisLabel:function(){var chart=this,times=this.OptimalAngleGrid.optimal&&this.OptimalAngleGrid.optimal.times||30,max=30*(parseInt((times-1)/30)+1);with(this.OptimalAngleGrid.maxTimes=max,this.OptimalAngleGrid.heightRatio=(this.OptimalAngleGrid.height-10)/this.OptimalAngleGrid.maxTimes,chart.context2DBuffer){clearRect(this.OptimalAngleGrid.left,this.OptimalAngleGrid.top,19,this.OptimalAngleGrid.height-10),save(),beginPath(),lineWidth=.5,font=" normal 8px impack",fillStyle="#2dfbfe";for(var yStepHeight=(this.OptimalAngleGrid.height-20)/6,i=0,len=6;len>=i;i++){var textValue=(max-i*(max/6)).toString();fillText(textValue,this.OptimalAngleGrid.left-3*textValue.length+10,this.OptimalAngleGrid.top+i*yStepHeight+5)}stroke(),restore()}},drawRealtimeAngleGrid:function(){var chart=this;with(chart.context2DBuffer){save(),lineWidth=1,fillStyle="rgba(0,177,179,1)",strokeStyle="rgba(0,177,179,1)",beginPath(),rect(chart.RealtimeAngleGrid.left+20,chart.RealtimeAngleGrid.top,chart.RealtimeAngleGrid.width-.5-20,chart.RealtimeAngleGrid.height),stroke(),restore(),save(),beginPath(),strokeStyle="rgba(0,77,77)",globalAlpha="0.8",lineWidth=.5,font=" normal 8px impack",fillStyle="#2dfbfe",translate(.25,.25);for(var yStepHeight=(parseInt((this.RealtimeAngleGrid.width-20)/10),this.RealtimeAngleGrid.height/10,this.RealtimeAngleGrid.height/12),i=0,len=12;len>i;i++){moveTo(this.RealtimeAngleGrid.left+20,this.RealtimeAngleGrid.top+i*yStepHeight),lineTo(this.RealtimeAngleGrid.left+this.RealtimeAngleGrid.width,this.RealtimeAngleGrid.top+i*yStepHeight);var textValue=(360-30*i).toString();"360"==textValue&&(textValue="359"),fillText(textValue,this.RealtimeAngleGrid.left-3*textValue.length+10,this.RealtimeAngleGrid.top+i*yStepHeight+5)}fillText(0,this.RealtimeAngleGrid.left+8,this.RealtimeAngleGrid.top+this.RealtimeAngleGrid.height+1);for(var xStepWidth=(this.RealtimeAngleGrid.width-20)/12,i=0,len=12;len>i;i++)moveTo(this.RealtimeAngleGrid.left+20+i*xStepWidth,this.RealtimeAngleGrid.top),lineTo(this.RealtimeAngleGrid.left+20+i*xStepWidth,this.RealtimeAngleGrid.top+this.RealtimeAngleGrid.height);stroke(),restore()}},drawAzimuthCircleData:function(angle){angle=angle||0;var chart=this,centerX=(chart.options.data||{},chart.AzimuthCircle.centerX),centerY=chart.AzimuthCircle.centerY,radius=chart.AzimuthCircle.radius;with(chart.context2D)clearRect(chart.AzimuthCircle.left,chart.AzimuthCircle.top,chart.AzimuthCircle.width,chart.AzimuthCircle.height),save(),strokeStyle="#f00",fillStyle="#f00",beginPath(),translate(centerX,centerY),rotate((angle-90)*Math.PI/180),moveTo(10,-3),lineTo(10,3),lineTo(radius-20,0),fill(),stroke(),restore(),save(),beginPath(),translate(centerX,centerY),fillStyle="#00ffff",font=" bold 22px impack",textAlign="center",fillText(Math.round(100*angle)/100,0,(radius-55)/2-5),stroke(),restore();"undefined"!=typeof chart.OptimalAngleGrid.optimal&&(this._drawOptimalAngel(chart.OptimalAngleGrid.optimal&&chart.OptimalAngleGrid.optimal.angle||0,"#cc00cc"),this._drawOptimalAngel(chart.OptimalAngleGrid.suboptimal&&chart.OptimalAngleGrid.suboptimal.angle||0,"#0a8a1f"),this._drawOptimalAngel(chart.OptimalAngleGrid.superior&&chart.OptimalAngleGrid.superior.angle||0,"#985f0d"))},_drawOptimalAngel:function(angle,color){var chart=this,centerX=chart.AzimuthCircle.centerX,centerY=chart.AzimuthCircle.centerY,radius=chart.AzimuthCircle.radius;with(chart.context2D)save(),beginPath(),fillStyle=color,strokeStyle=color,translate(centerX,centerY),rotate((angle-90)*Math.PI/180),moveTo(10,-2),lineTo(10,2),lineTo(radius-25,0),fill(),stroke(),restore()},drawTextMarkData:function(t){var i=this,e=$(".freq-mark",i.container);if(e.text(t.freq+" MHz"),!this.options.showMin){var a=$(".text-mark",i.container);a.find(".qulity").text(ConvertFloat(t.qulity,2)),a.find(".north").text(t.north),a.find(".optimal").text(this.OptimalAngleGrid.optimal&&this.OptimalAngleGrid.optimal.angle),a.find(".level").text(t.level),a.find(".dfLevel").text(t.dfLevel),
a.find(".freq").text(t.freq)}},drawMeterData:function(options,value){var chart=this;with(chart.context2D)clearRect(options.left+31,options.top+1,11,options.height-1),save(),strokeStyle="#2d3132",fillStyle="#2d3132",beginPath(),lineWidth=1,rect(options.left+31+.5,options.top+1,10.5,(options.max-value)*options.heightRatio-2),fill(),stroke(),restore()},drawRealtimeAngleData:function(value){this.RealtimeAngleGrid.data=this.RealtimeAngleGrid.data||[],this.RealtimeAngleGrid.data.push(value);var itemWidth=this.RealtimeAngleGrid.itemWidth||5,maxLen=parseInt(this.RealtimeAngleGrid.width/itemWidth);with(this.RealtimeAngleGrid.data.length>=maxLen&&(this.RealtimeAngleGrid.data=this.RealtimeAngleGrid.data.slice(this.RealtimeAngleGrid.data.length-maxLen,maxLen)),this.context2D){clearRect(this.RealtimeAngleGrid.left+20,this.RealtimeAngleGrid.top,this.RealtimeAngleGrid.width,this.RealtimeAngleGrid.height),save(),beginPath(),lineWidth=1,strokeStyle="#008001",moveTo(this.RealtimeAngleGrid.left+20,this.RealtimeAngleGrid.top+this.RealtimeAngleGrid.height-this.RealtimeAngleGrid.data[0]*this.RealtimeAngleGrid.heightRatio);for(var i=1;i<this.RealtimeAngleGrid.data.length;i++)lineTo(this.RealtimeAngleGrid.left+20+i*itemWidth,this.RealtimeAngleGrid.top+this.RealtimeAngleGrid.height-this.RealtimeAngleGrid.data[i]*this.RealtimeAngleGrid.heightRatio);stroke(),restore()}},drawOptimalAngleData:function(value){var index=parseInt(value);this.OptimalAngleGrid.data=this.OptimalAngleGrid.data||new Array(360),this.OptimalAngleGrid.data[index]=this.OptimalAngleGrid.data[index]||0,this.OptimalAngleGrid.data[index]+=1;var $optimalMark=$(".optimal-mark",this.container);this.OptimalAngleGrid.optimal=this.OptimalAngleGrid.optimal||{angle:0,times:0},this.OptimalAngleGrid.suboptimal=this.OptimalAngleGrid.suboptimal||{angle:0,times:0},this.OptimalAngleGrid.superior=this.OptimalAngleGrid.superior||{angle:0,times:0},this.OptimalAngleGrid.data[index]>this.OptimalAngleGrid.optimal.times&&(this.OptimalAngleGrid.optimal={angle:index,times:this.OptimalAngleGrid.data[index]},$optimalMark.find(".optimal").text(index+"°("+this.OptimalAngleGrid.data[index]+"次)")),index!=this.OptimalAngleGrid.optimal.angle&&this.OptimalAngleGrid.data[index]>this.OptimalAngleGrid.suboptimal.times&&(this.OptimalAngleGrid.suboptimal={angle:index,times:this.OptimalAngleGrid.data[index]},$optimalMark.find(".suboptimal").text(index+"°("+this.OptimalAngleGrid.data[index]+"次)")),index!=this.OptimalAngleGrid.optimal.angle&&index!=this.OptimalAngleGrid.suboptimal.angle&&this.OptimalAngleGrid.data[index]>this.OptimalAngleGrid.superior.times&&(this.OptimalAngleGrid.superior={angle:index,times:this.OptimalAngleGrid.data[index]},$optimalMark.find(".superior").text(index+"°("+this.OptimalAngleGrid.data[index]+"次)")),this.OptimalAngleGrid.optimal.times>this.OptimalAngleGrid.maxTimes&&this.drawOptimalAngleGridYAxisLabel();var itemWidth=this.OptimalAngleGrid.itemWidth=(this.OptimalAngleGrid.width-20)/this.OptimalAngleGrid.data.length;with(this.context2D){clearRect(this.OptimalAngleGrid.left+20,this.OptimalAngleGrid.top,this.OptimalAngleGrid.width-20,this.OptimalAngleGrid.height),save(),beginPath(),lineWidth=1,strokeStyle="#2dfbfe",fillStyle="#008001";for(var i=0;i<this.OptimalAngleGrid.data.length;i++)this.OptimalAngleGrid.data[i]&&fillRect(this.OptimalAngleGrid.left+20+i*itemWidth,this.OptimalAngleGrid.top+this.OptimalAngleGrid.height-10-this.OptimalAngleGrid.data[i]*this.OptimalAngleGrid.heightRatio,itemWidth,this.OptimalAngleGrid.data[i]*this.OptimalAngleGrid.heightRatio);stroke(),restore()}},drawData:function(){if(this.options.data&&0!=this.options.data.length){var t=this.options.data[0];if(this.options.showMin){this.drawTextMarkData(t);var i=this.AzimuthCircle.isNorthAngle&&t.north||t.azumith||0;return this.drawAzimuthCircleData(i),void this.drawOptimalAngleData(t.north)}if(this.drawTextMarkData(t),this.drawMeterData(this.LevelMeter,t.dfLevel),this.drawMeterData(this.QualityMeter,t.qulity),parseFloat(t.level)>=parseFloat(this.LevelMeter.filterValue||0)&&parseFloat(t.qulity)>=parseFloat(this.QualityMeter.filterValue||0)){var i=this.AzimuthCircle.isNorthAngle&&t.north||t.azumith||0;this.drawAzimuthCircleData(i),this.drawRealtimeAngleData(t.north),this.drawOptimalAngleData(t.north)}}}},$.fn.rxdfchart=function(t){var i=new Chart(this,t);return $(this).data("chart",i),i},$.fn.rxdfchart.defaults={width:850,height:450,mouseEvent:"enabled",data:[]}}(jQuery),function($){function Chart(t,i){$this=this,this.target=t,this.container=$(t),this.options=$.extend(!0,{},$.fn.rxgridchart.defaults,i),this.container.data("option",this.options),this.originOptions=$.extend(!0,{},this.options),this.stepXArr=[],this.stepYArr=[],this.xAxisLabelHeight="falls"==this.options.type?1:30,this.gradientColors=[],this.grid={left:30,top:0,height:336,width:this.options.width-60,ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height}},this.Colorlegend={left:this.grid.left+this.grid.width+5,top:35,height:this.options.height-36,width:25,ContainsXY:function(t,i){return t>=this.left&&t<=this.left+this.width&&i>=this.top&&i<=this.top+this.height}};var e=this;this.canvasElmBuffer=this._createCanvas(),this.context2DBuffer=this._getContext2D(this.canvasElmBuffer),this.gridContainer=$('<div style="position: absolute;z-index: 100;"><div class="layout-fill" style="height: 336px;"></div></div>').css({top:35,left:0,width:e.options.width-26,height:e.options.height-36}).appendTo(e.container),this.gridContainer.niceScroll({cursorwidth:"12px"}),this.canvasElmGridBuffer=this._createCanvas($.extend({},this.grid,{width:e.options.width-26}),this.gridContainer.children()),this.context2DGridBuffer=this._getContext2D(this.canvasElmGridBuffer),this.canvasElm=this._createCanvas($.extend({},this.grid,{width:e.options.width-26}),this.gridContainer.children()),this.context2D=this._getContext2D(this.canvasElm),this.canvasElmInfo=this._createCanvas($.extend({},this.grid,{width:e.options.width-26}),this.gridContainer.children()),this.context2DInfo=this._getContext2D(this.canvasElmInfo),this.itemWidth=1,this.draw(!0),this.bindMouseEvent()}function _mousedown(t){$.rx.paramGetFocus||t.preventDefault();$(this).data("chart");t=getEventPosition(t)}function _mouseup(t){t.preventDefault();$(this).data("chart")}function _click(t){t.preventDefault();$(this).data("chart");t=getEventPosition(t)}function _mousemove(t){t.preventDefault();var i=$(this).data("chart");t=getEventPosition(t),i.grid.ContainsXY(t.x,t.y)?_gridShowInfo(i,t):i.context2DInfo.clearRect(0,0,i.options.width,i.options.height)}function _mouseout(t){t.preventDefault();var i=$(this).data("chart");i.context2DInfo.clearRect(0,0,i.options.width,i.options.height)}function _gridShowInfo(chart,event){var dataItem=chart._getDataItemByXY(event.x,event.y);with(chart.context2DInfo){if(clearRect(chart.grid.left,chart.grid.top-30,chart.grid.width,chart.grid.height+30),$(".textinfo",chart.container).text(""),strokeStyle="#00fbfe",fillStyle="#2dfbfe",save(),beginPath(),globalAlpha="0.5",translate(.5,.5),lineWidth=.5,rect(chart.grid.left+parseInt((event.x-chart.grid.left)/chart.grid.cell.width)*chart.grid.cell.width,chart.grid.top+parseInt((event.y-chart.grid.top)/chart.grid.cell.height)*chart.grid.cell.height,chart.grid.cell.width,chart.grid.cell.height),stroke(),beginPath(),lineWidth=1,globalAlpha="1",dataItem){var date=moment(dataItem.name),textValue="时间:"+date.format("MM月DD日 HH:mm")+"	"+dataItem.value+(dataItem.unit||""),$textInfo=$(".textinfo",chart.container);0==$textInfo.length&&$('<div class="textinfo" style="color:#2dfbfe; position: absolute; "></div>').css({top:"5px",left:chart.grid.left+65+"px"}).appendTo(chart.container),$textInfo.text(textValue)}stroke(),restore()}}Chart.prototype={draw:function(t){t&&(this.context2DBuffer.clearRect(0,0,this.options.width,this.options.height),this.context2DGridBuffer.clearRect(0,0,this.options.width,this.options.height),this._drawGrid(),this._drawColorlegend()),this.drawData()},getOption:function(){var t=this.container.data("option");return"undefined"==typeof t&&(t={}),t},setOption:function(t,i,e){var a=this.getOption();this.options=$.extend({},a,t),this.container.data("option",this.options),e&&(this.originOptions=$.extend(!0,{},this.options)),this.draw(i)},resize:function(t,i){this.options.width=t,this.options.height=i,this.grid.width=t-60,this.container.width(t+"px"),this.container.height(i+"px"),this.Colorlegend.left=this.grid.left+this.grid.width+5,this.Colorlegend.height=this.options.height-36,this.gridContainer.width(t-26+"px"),this.gridContainer.height(i-36+"px"),this.canvasElmBuffer.width=t,this.canvasElmBuffer.height=i,this.canvasElm.width=t-26,this.canvasElmInfo.width=t-26,this.canvasElmGridBuffer.width=t-26,this.setOption({width:t,height:i},!0,!0),this.redrawData()},destroy:function(){this.container.remove("canvas"),this.container.removeData("option"),delete this},clear:function(){_clear(this)},bindMouseEvent:function(t){"disabled"!=this.options.mouseEvent&&this.container.mousedown(_mousedown).mousemove(_mousemove).mouseup(_mouseup).mouseout(_mouseout).click(_click)},_createCanvas:function(t,i){this.zIndex=this.zIndex||0;var e=document.createElement("canvas");return $(e).appendTo(i||this.container).css({position:"absolute",left:"0px",top:(t&&t.top||0)+"px","z-index":++this.zIndex}),e.id=uuid.v1(),e.width=t&&t.width||this.options.width,e.height=t&&t.height||this.options.height,e},_getContext2D:function(t){return t=t||this.canvasElm,t.getContext||G_vmlCanvasManager.initElement(t),t.getContext("2d")},_getDataItemByXY:function(t,i){var e;t=parseInt((t-this.grid.left)/this.grid.cell.width),i=parseInt((i-this.grid.top)/this.grid.cell.height);for(var a=this.options.cacheData,n=0;n<a.length;n++){var r=this._getXYByName(a[n].name);if(r.x==t&&r.y==i){e=a[n];break}}return e},_getColor:function(t){if(!this.options.showColorlegend)return this.options.colorlegend.colors[0]||"#ff0";for(var i=0,e=this.gradientColors.length-1,a=Math.floor((e+i)/2);a>0&&!(this.gradientColors[a-1].value<=t&&this.gradientColors[a].value>=t)&&e>i;)this.gradientColors[a].value>t?e=a-1:this.gradientColors[a].value<t&&(i=a+1),a=Math.floor((e+i)/2);return this.gradientColors[a].color},_drawColorlegend:function(){if(!(this.options.colorlegend.colors.length<2)){var gradient=new gradientColorArr(this.options.colorlegend.colors,this.Colorlegend.height),valStep=Math.round(parseFloat(this.options.colorlegend.max-this.options.colorlegend.min)/this.Colorlegend.height*100)/100,len=gradient.length;with(this.context2DBuffer){save(),beginPath(),fillStyle=gradient[0],strokeStyle=gradient[0],fillRect(this.Colorlegend.left,this.Colorlegend.top-1,this.Colorlegend.width,1);for(var i=0;len>i;i++)this.gradientColors.push({value:this.options.colorlegend.min+valStep*i,color:gradient[len-1-i]}),fillStyle=gradient[i],strokeStyle=gradient[i],fillRect(this.Colorlegend.left,this.Colorlegend.top+i,this.Colorlegend.width,1),fill();beginPath();for(var yMax=this.options.colorlegend.max,step=this.options.colorlegend.step,yMin=this.options.colorlegend.min,tickWidth=this.Colorlegend.height/step,i=0;step>=i;i++)if(font="normal normal 10px 微软雅黑",fillStyle="#000",i%2==0){var textoffset=4;0==i?textoffset=-2:i==step&&(textoffset=9),textAlign="left";var textValue=Math.round((yMax-yMin)/step*i+yMin);fillText(textValue,this.Colorlegend.left,this.Colorlegend.top+this.Colorlegend.height-tickWidth*i+textoffset)}stroke(),restore()}}},_drawGrid:function(){var chart=this;with(chart.grid.cell={width:ConvertFloat(chart.grid.width/60,4),height:14},this.context2DBuffer){save(),strokeStyle="rgba(0,177,179,1)",fillStyle="#2dfbfe",lineWidth=1,rect(chart.grid.left+.5,35.5,chart.grid.width-1,chart.options.height-36-.5),fillText("[小时：分钟]",chart.grid.left-30,20),fillText(chart.options.title,chart.grid.left+.35*chart.grid.width,20),stroke(),restore(),save(),beginPath(),strokeStyle="rgba(0,177,179,1)",fillStyle="#2dfbfe",globalAlpha="0.5",lineWidth=.5,chart.options.xAxis.data=[];for(var i=0;59>=i;i++)beginPath(),globalAlpha="0.5",moveTo(chart.grid.left+(i+1)*chart.grid.cell.width+.25,35),lineTo(chart.grid.left+(i+1)*chart.grid.cell.width,35+chart.grid.height),stroke(),chart.options.xAxis.data.push(i),i%2!=0&&(beginPath(),globalAlpha="1",textAlign="center",fillText(i,chart.grid.left+(i+.5)*chart.grid.cell.width,33));restore()}with(chart.context2DGridBuffer){beginPath(),strokeStyle="rgba(0,177,179,1)",fillStyle="#2dfbfe",globalAlpha="0.5",lineWidth=.5,translate(.25,.25);var now=moment();chart.options.yAxis.data=[];for(var i=0;24>i;i++)beginPath(),globalAlpha="0.5",moveTo(chart.grid.left,chart.grid.top+(i+1)*chart.grid.cell.height),lineTo(chart.grid.left+chart.grid.width,chart.grid.top+(i+1)*chart.grid.cell.height),stroke(),beginPath(),globalAlpha="1",textAlign="right",fillText(now.format("HH:00"),chart.grid.left,chart.grid.top+(i+1)*chart.grid.cell.height-3),chart.options.yAxis.data.push(now.format("HH:00")),now.add(1,"h");restore()}},_getXYByName:function(t){var i,e,a=moment(t);e=a.minutes(),i=a.format("HH:00");var n=$.inArray(e,this.options.xAxis.data),r=$.inArray(i,this.options.yAxis.data);return{x:n,y:r}},redrawData:function(){var t=this;t.options.cacheData=t.options.cacheData||[],t.options.cacheData.forEach(function(i){var e=[i];t.drawData(e,!0)})},drawData:function(data,noCache){var chart=this;data=data||chart.options.data||[],noCache||(chart.options.cacheData=(chart.options.cacheData||[]).concat(data));var len=data.length;with(chart.context2D){save(),beginPath(),fillStyle="#f00";for(var i=0;len>i;i++){var xy=chart._getXYByName(data[i].name);fillStyle=chart._getColor(data[i].value)||"#f00",fillRect(chart.grid.left+xy.x*chart.grid.cell.width+1,chart.grid.top+xy.y*chart.grid.cell.height+1,chart.grid.cell.width-2,chart.grid.cell.height-1)}stroke(),restore()}}},$.fn.rxgridchart=function(t){var i=new Chart(this,t);return $(this).data("chart",i),i},$.fn.rxgridchart.defaults={width:850,height:450,showColorlegend:!0,xAxis:{data:[]},yAxis:{data:[]},colorlegend:{min:0,max:100,step:10,colors:[]},mouseEvent:"enabled",data:[]}}(jQuery);
//# sourceMappingURL=rxchart.min.map